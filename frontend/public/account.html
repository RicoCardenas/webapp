<!DOCTYPE html>
<html lang="es" class="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mi Cuenta - EcuPlot</title>
    <meta name="description" content="Panel de usuario para gestionar tu cuenta y ver tu historial en EcuPlot." />
    <link rel="icon" href="/static/images/logo.jpg" type="image/jpeg" />
    <link rel="stylesheet" href="/static/styles.css" />
  </head>

  <body class="page page-account">
    <header id="site-header" class="header" role="banner" aria-label="Cabecera del sitio">
      <div class="header__inner">
        <div class="header__brand">
          <a href="/" class="header__logo" aria-label="Ir al inicio">
            <img
              src="/static/images/logo.jpg"
              alt="EcuPlot logo"
              class="header__logo-img img-responsive"
              decoding="async"
            />
            <span class="header__logo-text">EcuPlot</span>
          </a>
        </div>
        <nav id="primary-nav" class="nav header__nav" aria-label="Navegación principal">
          <ul class="nav__list" role="list">
            <li class="nav__item"><a class="nav__link" href="/" aria-current="page">Inicio</a></li>
            <li class="nav__item"><a class="nav__link" href="/graph">Graficadora</a></li>
          </ul>
        </nav>
        <div class="header__actions">
            <button
              class="btn btn--ghost header__btn btn--has-icon btn--icon-only"
              type="button"
              data-open="modal-login"
              aria-haspopup="dialog"
            aria-controls="modal-login"
            aria-label="Iniciar sesión"
          >
            <span class="btn__icon" aria-hidden="true">
              <img class="btn__icon-img btn__icon-img--light" src="/static/images/loginclaro.png" alt="" decoding="async" />
              <img class="btn__icon-img btn__icon-img--dark" src="/static/images/loginoscuro.png" alt="" decoding="async" />
            </span>
          </button>
          <button
            class="btn btn--primary header__btn btn--has-icon btn--icon-only"
            type="button"
            data-open="modal-signup"
            aria-haspopup="dialog"
            aria-controls="modal-signup"
            aria-label="Crear cuenta"
          >
            <span class="btn__icon" aria-hidden="true">
              <img class="btn__icon-img btn__icon-img--light" src="/static/images/signinclaro.png" alt="" decoding="async" />
              <img class="btn__icon-img btn__icon-img--dark" src="/static/images/signinoscuro.png" alt="" decoding="async" />
            </span>
          </button>
          <button
            id="btn-logout"
            class="btn header__btn header__btn--logout btn--has-icon btn--icon-only"
            type="button"
            aria-label="Cerrar sesión"
            style="display:none"
          >
            <span class="btn__icon" aria-hidden="true">
              <img class="btn__icon-img btn__icon-img--light" src="/static/images/logoutclaro.png" alt="" decoding="async" />
              <img class="btn__icon-img btn__icon-img--dark" src="/static/images/logoutoscuro.png" alt="" decoding="async" />
            </span>
          </button>
          <button class="btn btn--icon header__btn" type="button" aria-pressed="false" aria-label="Cambiar tema claro/oscuro" data-theme-toggle>
            <img class="icon icon--theme icon--theme-light" src="/static/images/luna.png" alt="" decoding="async" />
            <img class="icon icon--theme icon--theme-dark" src="/static/images/sol.png" alt="" decoding="async" />
          </button>
          <button
            class="btn btn--icon header__btn header__btn--menu"
            type="button"
            aria-label="Abrir menú"
            aria-controls="mobile-drawer"
            aria-expanded="false"
            data-drawer-toggle
          >
            <img class="icon icon--menu icon--menu-light" src="/static/images/hamburgblack.png" alt="" decoding="async" />
            <img class="icon icon--menu icon--menu-dark" src="/static/images/hamburgwhite.png" alt="" decoding="async" />
          </button>
        </div>

        <!-- Navegación primaria -->
      </div>
    </header>

    <aside id="mobile-drawer" class="drawer" aria-hidden="true" aria-labelledby="mobile-drawer-title" role="dialog">
      <div class="drawer__overlay" data-drawer-toggle tabindex="-1" aria-hidden="true"></div>
      <div class="drawer__panel" role="document">
        <div class="drawer__header">
          <h2 id="mobile-drawer-title" class="drawer__title">Menú</h2>
          <button class="drawer__close btn btn--icon" type="button" data-drawer-toggle aria-label="Cerrar menú">
            <span class="btn__icon" aria-hidden="true">
              <img class="btn__icon-img btn__icon-img--light" src="/static/images/closeclaro.png" alt="" decoding="async" />
              <img class="btn__icon-img btn__icon-img--dark" src="/static/images/closeoscuro.png" alt="" decoding="async" />
            </span>
          </button>
        </div>
        <nav class="drawer__nav" aria-label="Navegación móvil">
          <ul class="drawer__list" role="list">
            <li class="drawer__item"><a class="drawer__link" href="/#hero">Inicio</a></li>
            <li class="drawer__item"><a class="drawer__link" href="/#about">Acerca de</a></li>
            <li class="drawer__item"><a class="drawer__link" href="/#how-it-works">Cómo funciona</a></li>
            <li class="drawer__item"><a class="drawer__link" href="/#docs">Documentación</a></li>
            <li class="drawer__item"><a class="drawer__link" href="/graph">Graficadora</a></li>
            <li class="drawer__item"><a class="drawer__link" href="/account" aria-current="page">Mi cuenta</a></li>
            <li class="drawer__item"><a class="drawer__link" href="/#contact">Contacto</a></li>
          </ul>
          <div class="drawer__actions">
            <button class="btn btn--ghost drawer__btn" type="button" data-open="modal-login" aria-haspopup="dialog" aria-controls="modal-login">Iniciar sesión</button>
            <button class="btn btn--primary drawer__btn" type="button" data-open="modal-signup" aria-haspopup="dialog" aria-controls="modal-signup">Crear cuenta</button>
          </div>
        </nav>
      </div>
    </aside>

    <main class="account-main">
      <div id="account-authenticated" class="account-shell">
        <header class="account-hero">
          <div>
            <p class="account-hero__eyebrow">Panel personal</p>
            <h1 class="account-hero__title">Mi Cuenta</h1>
            <p class="account-hero__subtitle">Consulta tus datos de perfil y el historial de gráficas que has guardado.</p>
          </div>
          <div class="account-hero__actions">
            <a href="/" class="btn btn--ghost btn--sm">Ir al inicio</a>
            <a href="/graph" class="btn btn--primary btn--sm">Abrir graficadora</a>
          </div>
        </header>

        <div class="account-grid">
          <section class="account-card account-card--info" id="account-details-box">
            <div class="account-user">
              <div class="account-user__avatar" id="user-avatar" aria-hidden="true">EC</div>
              <div>
                <p class="account-user__label">Usuario autenticado</p>
                <p class="account-user__name" id="user-name">Cargando...</p>
                <div class="account-user__meta">
                  <span class="account-role-badge" id="user-role">Cargando...</span>
                  <span class="account-user__email" id="user-email">Cargando...</span>
                </div>
              </div>
            </div>

            <dl class="account-stats">
              <div>
                <dt>ID visible</dt>
                <dd id="user-visible-id">—</dd>
              </div>
              <div id="user-internal-id-row" hidden>
                <dt>ID interno (UUID)</dt>
                <dd id="user-internal-id">—</dd>
              </div>
              <div>
                <dt>Miembro desde</dt>
                <dd id="user-created-at">Cargando...</dd>
              </div>
              <div>
                <dt>Estado</dt>
                <dd id="user-status">Cargando...</dd>
              </div>
              <div>
                <dt>Historial guardado</dt>
                <dd id="history-count">—</dd>
              </div>
            </dl>

            <div class="account-card__footer">
              <button class="btn btn--ghost btn--sm" type="button" data-open="modal-login">Cambiar de cuenta</button>
              <button class="btn btn--primary btn--sm" type="button" id="account-history-cta">Ver historial</button>
            </div>
          </section>

          <section class="account-card account-card--history" id="account-history-box">
            <div class="account-card__header">
              <div>
                <p class="account-card__eyebrow">Seguimiento</p>
                <h2 class="account-card__title">Mi Historial de Gráficas</h2>
                <p class="account-card__subtitle">Revisa tus últimas funciones guardadas. El panel permanece oculto hasta que lo necesites.</p>
              </div>
              <div class="account-card__actions">
                <button id="history-toggle" class="btn btn--ghost btn--sm" type="button" aria-expanded="false" aria-controls="history-panel">Mostrar historial</button>
              </div>
            </div>

            <div id="history-panel" class="account-history__panel" hidden>
              <div id="history-loading" class="account-history__loading">
                <p>Cargando historial...</p>
              </div>
              <div id="history-empty" class="account-history__empty" hidden>
                <p>No tienes ningún historial de gráficas guardado.</p>
                <a href="/graph" class="btn btn--primary btn--sm">Ir al Graficador</a>
              </div>
              <ul id="plot-history-list" class="history-list"></ul>
            </div>
          </section>

          <section id="teacher-panel" class="account-card account-card--role" hidden>
            <div class="account-card__header">
              <div>
                <p class="account-card__eyebrow">Gestión docente</p>
                <h2 class="account-card__title">Mis grupos</h2>
                <p class="account-card__subtitle">Crea grupos y agrega estudiantes utilizando su ID visible.</p>
              </div>
              <div class="account-card__actions">
                <button id="teacher-create-group" class="btn btn--primary btn--sm" type="button">Crear grupo</button>
              </div>
            </div>
            <div class="account-card__body">
              <p id="teacher-groups-empty" class="account-card__empty">Aún no has creado grupos.</p>
              <div id="teacher-group-list" class="role-panel__list"></div>
            </div>
          </section>

          <section id="admin-panel" class="account-card account-card--role" hidden>
            <div class="account-card__header">
              <div>
                <p class="account-card__eyebrow">Panel administrador</p>
                <h2 class="account-card__title">Usuarios del sistema</h2>
                <p class="account-card__subtitle">Consulta el listado de docentes y promueve nuevos usuarios.</p>
              </div>
            </div>
            <div class="account-card__body">
              <form id="admin-assign-teacher-form" class="role-form" novalidate>
                <div class="form__field">
                  <label class="form__label" for="admin-assign-user-id">ID del usuario (UUID)</label>
                  <input class="form__input" type="text" id="admin-assign-user-id" autocomplete="off" placeholder="Ej. 123e4567-e89b-12d3-a456-426614174000" />
                  <p class="form__hint">Ingresa el identificador del usuario al que deseas otorgar el rol docente. Puedes dejarlo vacío si usas el ID visible.</p>
                </div>
                <div class="form__field">
                  <label class="form__label" for="admin-assign-visible-id">ID visible</label>
                  <input class="form__input" type="text" id="admin-assign-visible-id" autocomplete="off" placeholder="Ej. d2XBK2p6" />
                  <p class="form__hint">Alternativamente, escribe el ID visible mostrado al usuario.</p>
                </div>
                <div class="form__actions">
                  <button class="btn btn--primary btn--sm" type="submit">Asignar rol docente</button>
                </div>
              </form>
              <div id="admin-user-list" class="role-panel__list"></div>
              <div class="role-panel__section">
                <h3 class="account-card__subtitle">Grupos docentes</h3>
                <div id="admin-group-list" class="role-panel__list"></div>
              </div>
            </div>
          </section>

          <section id="development-panel" class="account-card account-card--role" hidden>
            <div class="account-card__header">
              <div>
                <p class="account-card__eyebrow">Panel development</p>
                <h2 class="account-card__title">Herramientas avanzadas</h2>
                <p class="account-card__subtitle">Gestiona roles administrativos y operaciones de respaldo.</p>
              </div>
            </div>
            <div class="account-card__body">
              <form id="development-assign-admin-form" class="role-form" novalidate>
                <div class="form__field">
                  <label class="form__label" for="development-user-id">ID de usuario (UUID)</label>
                  <input class="form__input" type="text" id="development-user-id" autocomplete="off" placeholder="UUID del usuario" />
                </div>
                <div class="form__field">
                  <label class="form__label" for="development-visible-id">ID visible</label>
                  <input class="form__input" type="text" id="development-visible-id" autocomplete="off" placeholder="visible_id (opcional)" />
                </div>
                <div class="form__field">
                  <label class="form__label" for="development-request-id">ID de solicitud</label>
                  <input class="form__input" type="text" id="development-request-id" autocomplete="off" placeholder="ID de solicitud (opcional)" />
                </div>
                <div class="form__actions">
                  <button class="btn btn--primary btn--sm" type="submit">Asignar rol admin</button>
                </div>
              </form>

              <div class="role-panel__actions">
                <button id="development-create-backup" class="btn btn--ghost btn--sm" type="button">Crear backup</button>
                <form id="development-restore-form" class="role-form role-form--inline" novalidate>
                  <div class="form__field">
                    <label class="form__label" for="development-backup-name">Nombre del backup</label>
                    <input class="form__input" type="text" id="development-backup-name" autocomplete="off" placeholder="Ej. backup-2025-10-30" />
                  </div>
                  <div class="form__actions">
                    <button class="btn btn--primary btn--sm" type="submit">Restaurar backup</button>
                  </div>
                </form>
              </div>

              <div class="role-panel__section">
                <h3 class="account-card__subtitle">Solicitudes de roles</h3>
                <div id="development-role-requests" class="role-panel__list"></div>
              </div>
            </div>
          </section>
        </div>
      </div>

      <section id="account-guest" class="account-guest" hidden>
        <div class="account-guest__card" role="dialog" aria-modal="true" aria-labelledby="account-guest-title">
          <h2 id="account-guest-title">Inicia sesión para ver tu cuenta</h2>
          <p>Para proteger tu información personal necesitas autenticarte. Si prefieres, puedes volver al inicio.</p>
          <div class="account-guest__actions">
            <button class="btn btn--primary" type="button" data-open="modal-login">Iniciar sesión</button>
            <a href="/" class="btn btn--ghost">Volver al inicio</a>
          </div>
        </div>
      </section>
    </main>

    <!-- Modal: Login -->
    <div id="modal-login" class="modal" role="dialog" aria-modal="true" aria-labelledby="login-title" aria-describedby="login-desc" aria-hidden="true">
      <div class="modal__overlay" data-close="modal" tabindex="-1" aria-hidden="true"></div>
      <div class="modal__dialog" role="document" tabindex="-1">
        <header class="modal__header">
          <h2 id="login-title" class="modal__title">Iniciar sesión</h2>
          <p id="login-desc" class="modal__desc">Accede a tu cuenta para gestionar tus funciones y exportaciones.</p>
          <button class="modal__close btn btn--icon" type="button" data-close="modal" aria-label="Cerrar">
            <span class="btn__icon" aria-hidden="true">
              <img class="btn__icon-img btn__icon-img--light" src="/static/images/closeclaro.png" alt="" decoding="async" />
              <img class="btn__icon-img btn__icon-img--dark" src="/static/images/closeoscuro.png" alt="" decoding="async" />
            </span>
          </button>
        </header>
        <div class="modal__body">
          <form class="form" action="/login" method="post" novalidate data-form-validate>
            <div class="form__field">
              <label class="form__label" for="login-email">Correo electrónico</label>
              <input class="form__input" type="email" id="login-email" name="email" autocomplete="email" inputmode="email" aria-describedby="error-login-email" required />
              <p id="error-login-email" class="form__error" aria-hidden="true"></p>
            </div>

            <div class="form__field">
              <label class="form__label" for="login-password">Contraseña</label>
              <div class="password-input">
                <input class="form__input" type="password" id="login-password" name="password" autocomplete="current-password" aria-describedby="error-login-password" required />
                <button class="password-toggle" type="button" data-password-toggle="login-password" aria-label="Mostrar contraseña">
                  <img src="/static/images/seepassword.png" alt="" data-icon="show" aria-hidden="true" />
                  <img src="/static/images/hidepassword.png" alt="" data-icon="hide" aria-hidden="true" hidden />
                </button>
              </div>
              <p id="error-login-password" class="form__error" aria-hidden="true"></p>
            </div>

            <div class="form__actions form__actions--split">
              <button class="btn btn--primary" type="submit">Entrar</button>
              <button class="form__link" type="button" data-open="modal-forgot">¿Olvidaste tu contraseña?</button>
            </div>

            <p class="form__hint">¿No tienes cuenta? <button class="link" type="button" data-open="modal-signup">Crear cuenta</button></p>
          </form>
        </div>
      </div>
    </div>

    <!-- Modal: Signup -->
    <div id="modal-signup" class="modal" role="dialog" aria-modal="true" aria-labelledby="signup-title" aria-describedby="signup-desc" aria-hidden="true">
      <div class="modal__overlay" data-close="modal" tabindex="-1" aria-hidden="true"></div>
      <div class="modal__dialog" role="document" tabindex="-1">
        <header class="modal__header">
          <h2 id="signup-title" class="modal__title">Crear cuenta</h2>
          <p id="signup-desc" class="modal__desc">Regístrate para guardar funciones, historiales y exportaciones.</p>
          <button class="modal__close btn btn--icon" type="button" data-close="modal" aria-label="Cerrar">
            <span class="btn__icon" aria-hidden="true">
              <img class="btn__icon-img btn__icon-img--light" src="/static/images/closeclaro.png" alt="" decoding="async" />
              <img class="btn__icon-img btn__icon-img--dark" src="/static/images/closeoscuro.png" alt="" decoding="async" />
            </span>
          </button>
        </header>

        <div class="modal__body">
          <form class="form" action="/signup" method="post" novalidate data-form-validate>
            <div class="form__field" data-layout="left">
              <label class="form__label" for="signup-name">Nombre</label>
              <input class="form__input" type="text" id="signup-name" name="name" autocomplete="name" aria-describedby="error-signup-name" required />
              <p id="error-signup-name" class="form__error" aria-hidden="true"></p>
            </div>

            <div class="form__field" data-layout="left">
              <label class="form__label" for="signup-email">Correo electrónico</label>
              <input class="form__input" type="email" id="signup-email" name="email" autocomplete="email" inputmode="email" aria-describedby="error-signup-email" required />
              <p id="error-signup-email" class="form__error" aria-hidden="true"></p>
            </div>

            <div class="form__field" data-layout="right">
              <label class="form__label" for="signup-password">Contraseña</label>
              <div class="password-input">
                <input class="form__input" type="password" id="signup-password" name="password" autocomplete="new-password" aria-describedby="error-signup-password" required />
                <button class="password-toggle" type="button" data-password-toggle="signup-password" aria-label="Mostrar contraseña">
                  <img src="/static/images/seepassword.png" alt="" data-icon="show" aria-hidden="true" />
                  <img src="/static/images/hidepassword.png" alt="" data-icon="hide" aria-hidden="true" hidden />
                </button>
              </div>
              <p id="error-signup-password" class="form__error" aria-hidden="true"></p>
            </div>

            <div class="form__field" data-layout="right">
              <label class="form__label" for="signup-password-confirm">Confirmar contraseña</label>
              <div class="password-input">
                <input class="form__input" type="password" id="signup-password-confirm" name="password_confirm" autocomplete="new-password" aria-describedby="error-signup-password-confirm" required />
                <button class="password-toggle" type="button" data-password-toggle="signup-password-confirm" aria-label="Mostrar contraseña">
                  <img src="/static/images/seepassword.png" alt="" data-icon="show" aria-hidden="true" />
                  <img src="/static/images/hidepassword.png" alt="" data-icon="hide" aria-hidden="true" hidden />
                </button>
              </div>
              <p id="error-signup-password-confirm" class="form__error" aria-hidden="true"></p>
            </div>

            <div class="form__field form__field--checkbox" data-layout="full">
              <input class="form__checkbox" type="checkbox" id="signup-terms" name="terms" required aria-describedby="error-signup-terms" />
              <label class="form__label" for="signup-terms">Acepto los <a href="/terminos">términos y condiciones</a>.</label>
              <p id="error-signup-terms" class="form__error" aria-hidden="true"></p>
            </div>

            <div class="form__actions" data-layout="full">
              <button class="btn btn--primary" type="submit">Crear cuenta</button>
              <p class="form__hint">¿Ya tienes cuenta? <button class="link" type="button" data-open="modal-login">Inicia sesión</button></p>
            </div>
          </form>
        </div>
      </div>
    </div>

    <div id="modal-forgot" class="modal" role="dialog" aria-modal="true" aria-labelledby="forgot-title" aria-hidden="true">
      <div class="modal__overlay" data-close="modal" tabindex="-1" aria-hidden="true"></div>
      <div class="modal__dialog" role="document" tabindex="-1">
        <header class="modal__header">
          <h2 id="forgot-title" class="modal__title">Recuperar contraseña</h2>
          <p class="modal__desc">Ingresa tu correo y te enviaremos un enlace para restablecer tu contraseña.</p>
          <button class="modal__close btn btn--icon" type="button" data-close="modal" aria-label="Cerrar">
            <span class="btn__icon" aria-hidden="true">
              <img class="btn__icon-img btn__icon-img--light" src="/static/images/closeclaro.png" alt="" decoding="async" />
              <img class="btn__icon-img btn__icon-img--dark" src="/static/images/closeoscuro.png" alt="" decoding="async" />
            </span>
          </button>
        </header>
        <div class="modal__body">
          <form class="form" novalidate>
            <div class="form__field">
              <label class="form__label" for="forgot-email">Correo electrónico</label>
              <input class="form__input" type="email" id="forgot-email" name="email" autocomplete="email" inputmode="email" aria-describedby="error-forgot-email" required />
              <p id="error-forgot-email" class="form__error" aria-hidden="true"></p>
            </div>
            <div class="form__actions form__actions--split">
              <button class="btn btn--primary" type="submit">Enviar instrucciones</button>
              <button class="form__link" type="button" data-close="modal">Cancelar</button>
            </div>
            <p class="form__hint">¿Recordaste tu contraseña? <button class="link" type="button" data-open="modal-login">Inicia sesión</button></p>
          </form>
        </div>
      </div>
    </div>

    <!-- Toasts -->
    <div id="toasts" class="toasts" aria-live="polite" aria-atomic="true"></div>

    <noscript>
      <div class="noscript">Para utilizar EcuPlot necesitas habilitar JavaScript. Actívalo en tu navegador y recarga la página.</div>
    </noscript>

    <script src="/static/app.js" type="module" defer></script>
    <script src="/static/account-page.js" type="module" defer></script>
  </body>
</html>
